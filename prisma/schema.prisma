// GenAI-Merch Database Schema
// Type-safe database access with Prisma ORM

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User accounts (synced with Supabase Auth)
model User {
  id            String               @id @default(cuid())
  email         String               @unique
  name          String?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  organizations OrganizationMember[]
  designs       Design[]
  orders        Order[]
  groupOrders   GroupOrder[]
}

// Organizations for team/company accounts
model Organization {
  id           String               @id @default(cuid())
  name         String
  slug         String               @unique
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  members      OrganizationMember[]
  brandProfile BrandProfile?
}

// Brand profile for design consistency
model BrandProfile {
  id             String       @id @default(cuid())
  organizationId String       @unique
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  logoUrl        String?
  colorPalette   Json         // Array of hex colors
  fonts          Json         // Font specifications
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}

// Custom apparel designs
model Design {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  imageUrl  String   // Raster image (PNG/JPG)
  vectorUrl String?  // Vector file (SVG)
  metadata  Json     // Design specifications (DPI, colors, dimensions)
  aiPrompt  String?  // Original AI prompt if generated by AI
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

// Individual orders
model Order {
  id              String      @id @default(cuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id])
  designId        String
  design          Design      @relation(fields: [designId], references: [id])
  groupOrderId    String?
  groupOrder      GroupOrder? @relation(fields: [groupOrderId], references: [id])
  productType     String      // "t-shirt", "hoodie", etc.
  size            String      // "S", "M", "L", etc.
  quantity        Int
  status          String      @default("pending") // pending, processing, shipped, delivered
  stripeSessionId String?
  printfulOrderId String?
  shippingAddress Json        // Full address object
  price           Float       // Price in cents
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

// Group orders for team/event merchandise
model GroupOrder {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  deadline    DateTime
  status      String   @default("open") // open, closed, processing
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders      Order[]
}

// Organization membership and roles
model OrganizationMember {
  id             String       @id @default(cuid())
  userId         String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  role           String       @default("member") // member, admin, owner
  createdAt      DateTime     @default(now())

  @@unique([userId, organizationId])
}
